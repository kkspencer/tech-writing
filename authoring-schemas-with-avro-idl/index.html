<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=author content="Kelvin Spencer"><link rel="shortcut icon" href=/images/logo.png><meta name=generator content="mkdocs-1.1.2, mkdocs-material-5.2.2"><title>Avro IDL - Tech Writing</title><link rel=stylesheet href=../assets/stylesheets/main.a2408e81.min.css><link rel=stylesheet href=../assets/stylesheets/palette.a46bcfb3.min.css><meta name=theme-color content><link href=https://fonts.gstatic.com rel=preconnect crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Ubuntu:300,400,400i,700%7CUbuntu+Mono&display=fallback"><style>body,input{font-family:"Ubuntu",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Ubuntu Mono",SFMono-Regular,Consolas,Menlo,monospace}</style><link rel=manifest href=../manifest.webmanifest crossorigin=use-credentials></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary=white data-md-color-accent=pink> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#usage class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <header class=md-header data-md-component=header> <nav class="md-header-nav md-grid" aria-label=Header> <a href=.. title="Tech Writing" class="md-header-nav__button md-logo" aria-label="Tech Writing"> <img src=/images/logo.png alt=logo> </a> <label class="md-header-nav__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg> </label> <div class=md-header-nav__title data-md-component=header-title> <div class=md-header-nav__ellipsis> <span class="md-header-nav__topic md-ellipsis"> Tech Writing </span> <span class="md-header-nav__topic md-ellipsis"> Avro IDL </span> </div> </div> <label class="md-header-nav__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query data-md-state=active> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </label> <button type=reset class="md-search__icon md-icon" aria-label=Clear data-md-component=search-reset tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg> </button> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list></ol> </div> </div> </div> </div> </div> </nav> </header> <div class=md-container data-md-component=container> <nav class=md-tabs aria-label=Tabs data-md-component=tabs> <div class="md-tabs__inner md-grid"> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=.. class="md-tabs__link md-tabs__link--active"> Home </a> </li> </ul> </div> </nav> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=.. title="Tech Writing" class="md-nav__button md-logo" aria-label="Tech Writing"> <img src=/images/logo.png alt=logo> </a> Tech Writing </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=.. title=Home class=md-nav__link> Home </a> </li> <li class=md-nav__item> <a href=../using-go-modules/ title="Go Modules" class=md-nav__link> Go Modules </a> </li> <li class=md-nav__item> <a href=../getting-started-with-cuelang/ title=Cuelang class=md-nav__link> Cuelang </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" data-md-toggle=toc type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> Avro IDL <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 9h14V7H3v2m0 4h14v-2H3v2m0 4h14v-2H3v2m16 0h2v-2h-2v2m0-10v2h2V7h-2m0 6h2v-2h-2v2z"/></svg> </span> </label> <a href=./ title="Avro IDL" class="md-nav__link md-nav__link--active"> Avro IDL </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> Table of contents </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=#usage class=md-nav__link> Usage </a> </li> <li class=md-nav__item> <a href=#data-types class=md-nav__link> Data Types </a> <nav class=md-nav aria-label="Data Types"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#primitive-data-types class=md-nav__link> Primitive Data Types </a> </li> <li class=md-nav__item> <a href=#complex-data-types class=md-nav__link> Complex Data Types </a> <nav class=md-nav aria-label="Complex Data Types"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#records class=md-nav__link> Records </a> </li> <li class=md-nav__item> <a href=#enums class=md-nav__link> Enums </a> </li> <li class=md-nav__item> <a href=#arrays class=md-nav__link> Arrays </a> </li> <li class=md-nav__item> <a href=#maps class=md-nav__link> Maps </a> </li> <li class=md-nav__item> <a href=#unions class=md-nav__link> Unions </a> </li> <li class=md-nav__item> <a href=#fixed class=md-nav__link> Fixed </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#logical-types class=md-nav__link> Logical Types </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#naming-conventions class=md-nav__link> Naming Conventions </a> <nav class=md-nav aria-label="Naming Conventions"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#named-types class=md-nav__link> Named Types </a> </li> <li class=md-nav__item> <a href=#aliases class=md-nav__link> Aliases </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#annotations-comments-and-other-language-constructs class=md-nav__link> Annotations, Comments and Other Language Constructs </a> </li> <li class=md-nav__item> <a href=#schema-imports-and-references-to-named-schemas class=md-nav__link> Schema Imports and References to Named Schemas </a> </li> <li class=md-nav__item> <a href=#references class=md-nav__link> References </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> Table of contents </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=#usage class=md-nav__link> Usage </a> </li> <li class=md-nav__item> <a href=#data-types class=md-nav__link> Data Types </a> <nav class=md-nav aria-label="Data Types"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#primitive-data-types class=md-nav__link> Primitive Data Types </a> </li> <li class=md-nav__item> <a href=#complex-data-types class=md-nav__link> Complex Data Types </a> <nav class=md-nav aria-label="Complex Data Types"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#records class=md-nav__link> Records </a> </li> <li class=md-nav__item> <a href=#enums class=md-nav__link> Enums </a> </li> <li class=md-nav__item> <a href=#arrays class=md-nav__link> Arrays </a> </li> <li class=md-nav__item> <a href=#maps class=md-nav__link> Maps </a> </li> <li class=md-nav__item> <a href=#unions class=md-nav__link> Unions </a> </li> <li class=md-nav__item> <a href=#fixed class=md-nav__link> Fixed </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#logical-types class=md-nav__link> Logical Types </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#naming-conventions class=md-nav__link> Naming Conventions </a> <nav class=md-nav aria-label="Naming Conventions"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#named-types class=md-nav__link> Named Types </a> </li> <li class=md-nav__item> <a href=#aliases class=md-nav__link> Aliases </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#annotations-comments-and-other-language-constructs class=md-nav__link> Annotations, Comments and Other Language Constructs </a> </li> <li class=md-nav__item> <a href=#schema-imports-and-references-to-named-schemas class=md-nav__link> Schema Imports and References to Named Schemas </a> </li> <li class=md-nav__item> <a href=#references class=md-nav__link> References </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content> <article class="md-content__inner md-typeset"> <h1>Avro IDL</h1> <p><a href=https://avro.apache.org/docs/current/ >Apache Avro</a> is a binary encoding format that uses a schema to specify the structure of the data being encoded.</p> <p>The <a href=http://avro.apache.org/docs/current/idl.html><em>Avro IDL</em></a> (Interface Description Language) is a high level language for authoring Avro schemas. This allows developers to author schemas in a way that feels familiar to writing code, instead of the error-prone process of filling out a JSON schema by hand. In this documentation, we will focus on common <a href=http://avro.apache.org/docs/current/idl.html><em>Avro IDL</em></a> features.</p> <details class=info open=open><summary>Content</summary><ul> <li><a href=#usage>Usage</a></li> <li><a href=#data-types>Data Types</a></li> <li><a href=#naming-conventions>Naming Conventions</a></li> <li><a href=#annotations-comments-and-other-language-constructs>Annotations, Comments, and other language constructs</a></li> <li><a href=#schema-imports-and-references-to-named-schemata>Schema Imports</a></li> </ul> </details> <details class=tip open=open><summary>An IDL is not unique to Avro</summary><blockquote> <p>It is important to note that an Interface Description Language (IDL) is simply a descriptive language used to define data types and interfaces in a way that is independent of a programming language or platform. An IDL specifies only the syntax used to define the data types and interfaces.</p> </blockquote> </details> <h2 id=usage>Usage<a class=headerlink href=#usage title="Permanent link">&para;</a></h2> <p>In this section, we will walk through the creation of an event schema using the <em>Avro IDL</em>, generate the corresponding <em>Avro JSON schema</em> which can then be used by the <a href=github.com/heetch/avro/cmd/avrogo>avrogo tool</a> to generate Go data structures for your services.</p> <p>This should provide the necessary context before diving into the specifics of authoring schemas with the <em>Avro IDL</em>.</p> <details class=info open=open><summary>Avro IDL Schema declaration</summary><ul> <li>First, make sure you have a version of java (such as <a href=https://openjdk.java.net>OpenJDK</a>) installed on your machine</li> <li><a href=https://mvnrepository.com/artifact/org.apache.avro/avro-tools/1.9.2>Download and install the avro-tools</a></li> <li>Check that the avro-tools have been properly installed by running<ul> <li><code>java -jar avro-tools-{$version}.jar</code> where <code>{$version}</code> is the version of the avro-tools you just downloaded</li> </ul> </li> </ul> <p><strong>Example: Schema declaration for a service</strong></p> <div class=tabbed-set data-tabs=1:1><input checked=checked id=__tabbed_1_1 name=__tabbed_1 type=radio><label for=__tabbed_1_1>Schema with imported headers</label><div class=tabbed-content></div> </div> <div class=highlight><pre><span></span><code><span class=err>@</span><span class=n>namespace</span><span class=p>(</span><span class=s>&quot;service_name&quot;</span><span class=p>)</span>
<span class=n>protocol</span> <span class=n>service_event</span> <span class=p>{</span>
<span class=cm>/* </span>
<span class=cm>    headers.avdl contains the standard headers that must be included with every</span>
<span class=cm>    avro event.</span>
<span class=cm>*/</span>
<span class=n>import</span> <span class=n>idl</span> <span class=s>&quot;../headers.avdl&quot;</span><span class=p>;</span>

<span class=cm>/*</span>
<span class=hll><span class=cm>    add other schema imports if needed</span>
</span><span class=hll><span class=cm>    import idl &quot;my_other_service.avdl&quot;;</span>
</span><span class=hll><span class=cm>    import schema &quot;my_other_service.avsc&quot;</span>
</span><span class=cm>*/</span>

<span class=err>@</span><span class=n>meta</span><span class=p>({</span>
    <span class=s>&quot;commentary&quot;</span><span class=o>:</span> <span class=s>&quot;This Schema describes version v0.0.0 of the event service_event from the service_name.&quot;</span><span class=p>,</span>
        <span class=s>&quot;version&quot;</span><span class=o>:</span> <span class=s>&quot;0.0.0&quot;</span><span class=p>,</span>
        <span class=s>&quot;event&quot;</span><span class=o>:</span> <span class=s>&quot;service_event&quot;</span><span class=p>,</span>
        <span class=s>&quot;eventDescription&quot;</span><span class=o>:</span> <span class=s>&quot;TODO: Please describe the service_event here.&quot;</span><span class=p>,</span>
        <span class=s>&quot;eventTriggeredBy&quot;</span><span class=o>:</span> <span class=s>&quot;TODO: Please desrcibe the circumstances under which the service_event event is triggered, here.&quot;</span><span class=p>,</span>
        <span class=s>&quot;status&quot;</span><span class=o>:</span> <span class=s>&quot;active&quot;</span><span class=p>,</span>
        <span class=s>&quot;partitions&quot;</span><span class=o>:</span> <span class=s>&quot;1&quot;</span><span class=p>,</span>
    <span class=s>&quot;topickey&quot;</span><span class=o>:</span> <span class=s>&quot;service_name.service_event&quot;</span>

    <span class=p>})</span>

<span class=cm>/* Put your enum definitions here. */</span>
<span class=hll>
</span>
<span class=n>record</span> <span class=n>service_event</span> <span class=p>{</span>
    <span class=cm>/* Do not remove the following line */</span>
    <span class=n>meta</span> <span class=n>Metadata</span><span class=p>;</span>

    <span class=cm>/* Put your payload definition here. */</span>
<span class=hll>
</span><span class=p>}</span>
</code></pre></div> <ul> <li><strong>Add service-specific data to the schema template</strong></li> </ul> <div class=tabbed-set data-tabs=2:1><input checked=checked id=__tabbed_2_1 name=__tabbed_2 type=radio><label for=__tabbed_2_1>Update schema template with service data</label><div class=tabbed-content></div> </div> <div class=highlight><pre><span></span><code><span class=err>@</span><span class=n>namespace</span><span class=p>(</span><span class=s>&quot;service_name&quot;</span><span class=p>)</span>
<span class=n>protocol</span> <span class=n>service_event</span><span class=p>{</span>
<span class=cm>/* </span>
<span class=cm>    headers.avdl contains the standard headers that must be included with every</span>
<span class=cm>    avro event.</span>
<span class=cm>*/</span>
<span class=n>import</span> <span class=n>idl</span> <span class=s>&quot;headers.avdl&quot;</span><span class=p>;</span>

<span class=err>@</span><span class=n>meta</span><span class=p>({</span>
    <span class=s>&quot;commentary&quot;</span><span class=o>:</span> <span class=s>&quot;This Schema describes version v0.0.0 of the event service_event from the service_name.&quot;</span><span class=p>,</span>
        <span class=s>&quot;version&quot;</span><span class=o>:</span> <span class=s>&quot;0.0.0&quot;</span><span class=p>,</span>
        <span class=s>&quot;event&quot;</span><span class=o>:</span> <span class=s>&quot;service_event&quot;</span><span class=p>,</span>
        <span class=s>&quot;eventDescription&quot;</span><span class=o>:</span> <span class=s>&quot;TODO: Please describe the service_event event here.&quot;</span><span class=p>,</span>
        <span class=s>&quot;eventTriggeredBy&quot;</span><span class=o>:</span> <span class=s>&quot;TODO: Please desrcibe the circumstances under which the service_event event is triggered, here.&quot;</span><span class=p>,</span>
        <span class=s>&quot;status&quot;</span><span class=o>:</span> <span class=s>&quot;active&quot;</span><span class=p>,</span>
        <span class=s>&quot;partitions&quot;</span><span class=o>:</span> <span class=s>&quot;1&quot;</span><span class=p>,</span>
    <span class=s>&quot;topickey&quot;</span><span class=o>:</span> <span class=s>&quot;service_name.service_event&quot;</span>

    <span class=p>})</span>

<span class=hll><span class=cm>/* Put your enum definitions here. */</span>
</span><span class=k>enum</span> <span class=n>Type</span> <span class=p>{</span>
    <span class=n>payment</span><span class=p>,</span> 
    <span class=n>payment_adjustment</span><span class=p>,</span> 
    <span class=n>direct_payment</span>
<span class=p>}</span>

<span class=hll><span class=k>enum</span> <span class=n>Mode</span> <span class=p>{</span>
</span>    <span class=n>cash</span><span class=p>,</span>
    <span class=n>card</span><span class=p>,</span>
    <span class=n>in_car_with_fee</span><span class=p>,</span>
    <span class=n>paid_by_platform</span>
<span class=p>}</span>

<span class=n>record</span> <span class=n>service_event</span> <span class=p>{</span>
    <span class=cm>/* Do not remove the following line */</span>
    <span class=n>meta</span> <span class=n>Metadata</span><span class=p>;</span>

<span class=hll>    <span class=cm>/* Put your payload definition here. */</span>
</span>    <span class=n>Type</span> <span class=n>PaymentType</span><span class=p>;</span>

    <span class=n>Mode</span> <span class=n>PaymentMode</span><span class=p>;</span>  

    <span class=n>string</span> <span class=n>ID</span><span class=p>;</span>

    <span class=k>union</span> <span class=p>{</span> <span class=n>null</span><span class=p>,</span> <span class=n>string</span> <span class=p>}</span> <span class=n>TransactionID</span><span class=p>;</span> <span class=c1>// optional</span>

    <span class=n>string</span> <span class=n>RideID</span><span class=p>;</span>

    <span class=n>string</span> <span class=n>BusinessEventName</span><span class=p>;</span>

    <span class=n>decimal</span> <span class=p>(</span><span class=mi>4</span><span class=p>,</span> <span class=mi>2</span><span class=p>)</span> <span class=n>ChargedAmount</span><span class=p>;</span>

    <span class=n>decimal</span> <span class=p>(</span><span class=mi>4</span><span class=p>,</span> <span class=mi>2</span><span class=p>)</span> <span class=n>PlatformFee</span><span class=p>;</span>

    <span class=n>decimal</span> <span class=p>(</span><span class=mi>3</span><span class=p>,</span> <span class=mi>2</span><span class=p>)</span> <span class=n>DiscountAmount</span><span class=p>;</span>

    <span class=n>string</span> <span class=n>Currency</span><span class=p>;</span>

    <span class=n>string</span> <span class=n>Country</span><span class=p>;</span>

    <span class=k>union</span> <span class=p>{</span> <span class=n>null</span><span class=p>,</span> <span class=n>string</span> <span class=p>}</span> <span class=n>Reason</span><span class=p>;</span> <span class=c1>// optional</span>

    <span class=err>@</span><span class=n>TimeStamp</span><span class=p>(</span><span class=s>&quot;timestamp-micros&quot;</span><span class=p>)</span> <span class=c1>// using a custom annotation to specify timestamp-micros</span>
    <span class=kt>long</span> <span class=n>CreatedAt</span><span class=p>;</span>

    <span class=n>timestamp_ms</span> <span class=n>UpdatedAt</span><span class=p>;</span> <span class=c1>// using the built-in Avro IDL timestamp_ms logicalType</span>

    <span class=n>string</span> <span class=err>`</span><span class=n>error</span><span class=err>`</span><span class=p>;</span> <span class=c1>// using an escaped Avro IDL keyword</span>
<span class=p>}</span>
</code></pre></div> <div class=tabbed-set data-tabs=3:1><input checked=checked id=__tabbed_3_1 name=__tabbed_3 type=radio><label for=__tabbed_3_1>Generate Avro Schema file (`.avsc`) files from the `.avdl` file using the `idl2schemata` command</label><div class=tabbed-content></div> </div> <div class=highlight><pre><span></span><code>java -jar avro-tools-{$version}.jar idl2schemata example_schema.avdl
</code></pre></div> <p><strong>The new Avro Schema file (<code>.avsc</code>) will be generated in the same folder as the <code>.avdl</code> file</strong></p> <p><strong>Bonus</strong></p> <p>You can also generate <code>Go</code> data structures from the <code>.avsc</code> file using <a href=github.com/heetch/avro/cmd/avrogo><strong>the <code>avrogo</code> command</strong></a></p> </details> <h2 id=data-types>Data Types<a class=headerlink href=#data-types title="Permanent link">&para;</a></h2> <p>As with programming languages, the <a href=http://avro.apache.org/docs/current/idl.html><em>AVRO IDL</em></a> defines data types that can be used as building blocks for authoring Avro schemas.</p> <p>The <a href=http://avro.apache.org/docs/current/idl.html><em>AVRO IDL</em></a> defines:</p> <ul> <li><a href=#primitive-data-types>primitive data types</a></li> <li><a href=#complex-data-types>complex data types</a></li> <li><a href=#logical-types>logical types</a></li> </ul> <details class=tip><summary>Reader's Schema vs Writer's Schema</summary><blockquote> <p>Because a schema is used to tell the datatype of each field, binary data can only be decoded correctly if the code reading the data knows the exact schema that the data was written with. If it uses a different schema, arbitrary data corruption could result.</p> <p>When an application wants to encode data, it encodes the data using whatever schema version it has. This is known as the <code>writer's schema</code>. A header is added to the data that encodes a <em>schema id</em> for the schema, which is found by querying the schema registry. This means that an application producing Avro messages <em>must</em> be using a schema that is already registered.</p> <p>When an application wants to decode data, it reads it into its own schema, known as the <code>reader's schema</code>. This does not have to be the same as the writer's schema, but it does have to be <em>compatible</em>. The process of transforming from the writer's schema to the reader's schema is known as <em>schema resolution</em> and full details <a href=https://avro.apache.org/docs/1.9.1/spec.html#Schema+Resolution>are available here</a>.</p> <p>The key idea with Avro is that the <code>writer's schema</code> and the <code>reader's schema</code> do not have to be the same, they only need to be compatible.</p> </blockquote> </details> <h3 id=primitive-data-types>Primitive Data Types<a class=headerlink href=#primitive-data-types title="Permanent link">&para;</a></h3> <p>In <em>Avro</em>, <em>Primitive</em> types have no specified attributes, and their names may not be defined in any namespace.</p> <p>As such, <em>primitive</em> types automatically qualify as defined type names.</p> <div class=tabbed-set data-tabs=4:1><input checked=checked id=__tabbed_4_1 name=__tabbed_4 type=radio><label for=__tabbed_4_1>Avro IDL declaration for `string` data type</label><div class=tabbed-content> <div class=highlight><pre><span></span><code><span class=n>string</span> <span class=n>ID</span><span class=p>;</span>
</code></pre></div> </div> </div> <div class=tabbed-set data-tabs=5:1><input checked=checked id=__tabbed_5_1 name=__tabbed_5 type=radio><label for=__tabbed_5_1>Equivalent Avro JSON schema (`.avsc`) for `string` data type</label><div class=tabbed-content> <div class=highlight><pre><span></span><code><span class=p>{</span>
    <span class=nt>&quot;name&quot;</span><span class=p>:</span> <span class=s2>&quot;ID&quot;</span><span class=p>,</span>
    <span class=nt>&quot;type&quot;</span><span class=p>:</span> <span class=s2>&quot;string&quot;</span>
<span class=p>}</span>
</code></pre></div> </div> </div> <p>The <em>Avro IDL</em> supports the following primitive types:</p> <table> <thead> <tr> <th>Avro IDL declaration</th> <th>Equivalent Avro JSON schema Type</th> <th>Description</th> </tr> </thead> <tbody> <tr> <td><code>null</code></td> <td><code>null</code></td> <td>no value</td> </tr> <tr> <td><code>boolean</code></td> <td><code>boolean</code></td> <td>binary value</td> </tr> <tr> <td><code>int</code></td> <td><code>int</code></td> <td>32-bit signed integer</td> </tr> <tr> <td><code>long</code></td> <td><code>long</code></td> <td>64-bit signed integer</td> </tr> <tr> <td><code>float</code></td> <td><code>float</code></td> <td>single precision (32-bit) IEEE 754 floating-point number</td> </tr> <tr> <td><code>double</code></td> <td><code>double</code></td> <td>double precision (64-bit) IEEE 754 floating-point number</td> </tr> <tr> <td><code>bytes</code></td> <td><code>bytes</code></td> <td>sequence of 8-bit unsigned bytes</td> </tr> <tr> <td><code>string</code></td> <td><code>string</code></td> <td>unicode character sequence</td> </tr> </tbody> </table> <h3 id=complex-data-types>Complex Data Types<a class=headerlink href=#complex-data-types title="Permanent link">&para;</a></h3> <p>Avro supports the following complex types:</p> <ul> <li><a href=#records>records</a></li> <li><a href=#enums>enums</a></li> <li><a href=#arrays>arrays</a></li> <li><a href=#maps>maps</a></li> <li><a href=#unions>unions</a></li> <li><a href=#fixed>fixed</a></li> </ul> <h4 id=records>Records<a class=headerlink href=#records title="Permanent link">&para;</a></h4> <details class=info open=open><summary>Record Types</summary><p><em>Records</em> are like <code>structs</code> in the sense that they can be composed of both <em>primitive</em> data types and <em>complex</em> data types.</p> <div class=tabbed-set data-tabs=6:1><input checked=checked id=__tabbed_6_1 name=__tabbed_6 type=radio><label for=__tabbed_6_1>Avro IDL declaration for a record type</label><div class=tabbed-content></div> </div> <div class=highlight><pre><span></span><code>    <span class=n>record</span> <span class=n>Service</span> <span class=p>{</span>
        <span class=n>string</span> <span class=n>service_name</span><span class=p>;</span>
        <span class=n>boolean</span> <span class=n>is_active</span><span class=p>;</span>
        <span class=n>timestamp</span><span class=o>-</span><span class=n>millis</span> <span class=n>created_at</span><span class=p>;</span>
    <span class=p>};</span>
</code></pre></div> <div class=tabbed-set data-tabs=7:1><input checked=checked id=__tabbed_7_1 name=__tabbed_7 type=radio><label for=__tabbed_7_1>Equivalent Avro JSON schema</label><div class=tabbed-content></div> </div> <div class=highlight><pre><span></span><code>    <span class=p>{</span>
        <span class=nt>&quot;type&quot;</span><span class=p>:</span> <span class=s2>&quot;record&quot;</span><span class=p>,</span>
        <span class=nt>&quot;name&quot;</span><span class=p>:</span> <span class=s2>&quot;Service&quot;</span><span class=p>,</span>
        <span class=nt>&quot;fields&quot;</span> <span class=p>:</span> <span class=p>[</span>
            <span class=p>{</span><span class=nt>&quot;name&quot;</span><span class=p>:</span> <span class=s2>&quot;service_name&quot;</span><span class=p>,</span> <span class=nt>&quot;type&quot;</span><span class=p>:</span> <span class=s2>&quot;string&quot;</span><span class=p>},</span>
            <span class=p>{</span><span class=nt>&quot;name&quot;</span><span class=p>:</span> <span class=s2>&quot;is_active&quot;</span><span class=p>,</span> <span class=nt>&quot;type&quot;</span><span class=p>:</span> <span class=s2>&quot;boolean&quot;</span><span class=p>}</span>
            <span class=p>{</span><span class=nt>&quot;name&quot;</span><span class=p>:</span> <span class=s2>&quot;created_at&quot;</span><span class=p>,</span> <span class=nt>&quot;type&quot;</span><span class=p>:</span> <span class=s2>&quot;long&quot;</span><span class=p>,</span> <span class=nt>&quot;logicalType&quot;</span><span class=p>:</span> <span class=s2>&quot;timestamp-millis&quot;</span><span class=p>}</span>
        <span class=p>]</span>
    <span class=p>}</span>
</code></pre></div> <div class="admonition warning"> <p class=admonition-title>Not all complex types can be embedded in a <em>Record</em></p> <blockquote> <p>Though the Avro specifications suggest that complex types such as <code>enum</code> types and even <code>record</code> types can be embedded within a <code>record</code>, the <em>Avro IDL</em> does not currently support these types of embeddings.</p> </blockquote> </div> <p><strong>With the current implementation, <code>record</code> types can only contain the following types:</strong></p> <ul> <li><code>array</code></li> <li><code>boolean</code></li> <li><code>double</code></li> <li><code>float</code></li> <li><code>int</code></li> <li><code>long</code></li> <li><code>map</code></li> <li><code>bytes</code></li> <li><code>string</code></li> <li><code>null</code></li> <li><code>union</code></li> <li><code>date</code></li> <li><code>time_ms</code></li> <li><code>timestamp_ms</code></li> </ul> </details> <h4 id=enums>Enums<a class=headerlink href=#enums title="Permanent link">&para;</a></h4> <details class=info open=open><summary>Enum Types</summary><p>Enumerated types are declared using the <code>enum</code> keyword.</p> <p>For example, to declare an <code>enum</code> describing a suit of playing cards:</p> <div class=tabbed-set data-tabs=8:1><input checked=checked id=__tabbed_8_1 name=__tabbed_8 type=radio><label for=__tabbed_8_1>Avro IDL declaration for an enum type</label><div class=tabbed-content></div> </div> <div class=highlight><pre><span></span><code>    <span class=k>enum</span> <span class=n>Suit</span> <span class=p>{</span>
        <span class=n>SPADES</span><span class=p>,</span> <span class=n>HEARTS</span><span class=p>,</span> <span class=n>DIAMONDS</span><span class=p>,</span> <span class=n>CLUBS</span>
    <span class=p>}</span>
</code></pre></div> <div class=tabbed-set data-tabs=9:1><input checked=checked id=__tabbed_9_1 name=__tabbed_9 type=radio><label for=__tabbed_9_1>Equivalent Avro JSON schema</label><div class=tabbed-content></div> </div> <div class=highlight><pre><span></span><code>    <span class=p>{</span> 
        <span class=nt>&quot;type&quot;</span><span class=p>:</span> <span class=s2>&quot;enum&quot;</span><span class=p>,</span>
        <span class=nt>&quot;name&quot;</span><span class=p>:</span> <span class=s2>&quot;Suit&quot;</span><span class=p>,</span>
        <span class=nt>&quot;symbols&quot;</span> <span class=p>:</span> <span class=p>[</span><span class=s2>&quot;SPADES&quot;</span><span class=p>,</span> <span class=s2>&quot;HEARTS&quot;</span><span class=p>,</span> <span class=s2>&quot;DIAMONDS&quot;</span><span class=p>,</span> <span class=s2>&quot;CLUBS&quot;</span><span class=p>]</span>
    <span class=p>}</span>
</code></pre></div> </details> <h4 id=arrays>Arrays<a class=headerlink href=#arrays title="Permanent link">&para;</a></h4> <details class=info open=open><summary>Array Types</summary><p>The <code>array</code> type can be used to declare a list of items defined by the same attribute.</p> <p><strong>Example: <code>array of strings</code></strong></p> <div class=tabbed-set data-tabs=10:1><input checked=checked id=__tabbed_10_1 name=__tabbed_10 type=radio><label for=__tabbed_10_1>Avro IDL declaration for array of strings</label><div class=tabbed-content></div> </div> <div class=highlight><pre><span></span><code>    <span class=n>array</span><span class=o>&lt;</span><span class=n>string</span><span class=o>&gt;</span> <span class=n>mountain_ranges</span><span class=p>;</span>
</code></pre></div> <div class=tabbed-set data-tabs=11:1><input checked=checked id=__tabbed_11_1 name=__tabbed_11 type=radio><label for=__tabbed_11_1>Equivalent Avro JSON schema</label><div class=tabbed-content></div> </div> <div class=highlight><pre><span></span><code>    <span class=p>{</span>
        <span class=nt>&quot;type&quot;</span><span class=p>:</span> <span class=s2>&quot;array&quot;</span><span class=p>,</span> 
        <span class=nt>&quot;name&quot;</span><span class=p>:</span> <span class=s2>&quot;mountain_ranges&quot;</span><span class=p>,</span>
        <span class=nt>&quot;items&quot;</span><span class=p>:</span> <span class=s2>&quot;string&quot;</span>
    <span class=p>}</span>
</code></pre></div> <p><strong>Example: <code>array of ints</code></strong></p> <div class=tabbed-set data-tabs=12:1><input checked=checked id=__tabbed_12_1 name=__tabbed_12 type=radio><label for=__tabbed_12_1>Avro IDL declaration for array of ints</label><div class=tabbed-content></div> </div> <div class=highlight><pre><span></span><code>    <span class=n>array</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;</span> <span class=n>number_bases</span><span class=p>;</span>
</code></pre></div> <div class=tabbed-set data-tabs=13:1><input checked=checked id=__tabbed_13_1 name=__tabbed_13 type=radio><label for=__tabbed_13_1>Equivalent Avro JSON schema</label><div class=tabbed-content></div> </div> <div class=highlight><pre><span></span><code>    <span class=p>{</span>
        <span class=nt>&quot;type&quot;</span><span class=p>:</span> <span class=s2>&quot;array&quot;</span><span class=p>,</span> 
        <span class=nt>&quot;name&quot;</span><span class=p>:</span> <span class=s2>&quot;number_bases&quot;</span><span class=p>,</span>
        <span class=nt>&quot;items&quot;</span><span class=p>:</span> <span class=s2>&quot;int&quot;</span>
    <span class=p>}</span>
</code></pre></div> </details> <h4 id=maps>Maps<a class=headerlink href=#maps title="Permanent link">&para;</a></h4> <details class=info open=open><summary>Map Types</summary><p>The <code>map</code> type can be used to declare a list of key-value pairs, where all keys are constrained to be <code>string</code> types.</p> <p><strong>Example: Map with <code>strings</code> as <em>keys</em> (by default), and <code>longs</code> as <em>values</em></strong></p> <div class=tabbed-set data-tabs=14:1><input checked=checked id=__tabbed_14_1 name=__tabbed_14 type=radio><label for=__tabbed_14_1>Avro IDL declaration for a map with `longs` as values</label><div class=tabbed-content></div> </div> <div class=highlight><pre><span></span><code>    <span class=n>map</span><span class=o>&lt;</span><span class=kt>long</span><span class=o>&gt;</span> <span class=n>astronomical_units_to_meters</span><span class=p>;</span>
</code></pre></div> <div class=tabbed-set data-tabs=15:1><input checked=checked id=__tabbed_15_1 name=__tabbed_15 type=radio><label for=__tabbed_15_1>Equivalent Avro JSON schema</label><div class=tabbed-content></div> </div> <div class=highlight><pre><span></span><code>    <span class=p>{</span>
        <span class=nt>&quot;type&quot;</span><span class=p>:</span> <span class=s2>&quot;map&quot;</span><span class=p>,</span>
        <span class=nt>&quot;name&quot;</span><span class=p>:</span> <span class=s2>&quot;astronomical_units_to_meters&quot;</span><span class=p>,</span>
        <span class=nt>&quot;values&quot;</span><span class=p>:</span> <span class=s2>&quot;long&quot;</span>
    <span class=p>}</span>
</code></pre></div> </details> <h4 id=unions>Unions<a class=headerlink href=#unions title="Permanent link">&para;</a></h4> <details class=info open=open><summary>Union Types</summary><p><code>union</code> types are often used to declare fields with optional values</p> <p><strong>Example: <code>union</code> declaring a schema which may be either a <code>null</code> type or a <code>string</code> type</strong></p> <div class=tabbed-set data-tabs=16:1><input checked=checked id=__tabbed_16_1 name=__tabbed_16 type=radio><label for=__tabbed_16_1>Avro IDL declaration for an optional string</label><div class=tabbed-content></div> </div> <div class=highlight><pre><span></span><code>    <span class=k>union</span> <span class=p>{</span> <span class=n>null</span><span class=p>,</span> <span class=n>string</span> <span class=p>}</span> <span class=n>optionalString</span><span class=p>;</span>
</code></pre></div> <div class=tabbed-set data-tabs=17:1><input checked=checked id=__tabbed_17_1 name=__tabbed_17 type=radio><label for=__tabbed_17_1>Equivalent Avro JSON schema</label><div class=tabbed-content></div> </div> <div class=highlight><pre><span></span><code><span class=p>{</span>
    <span class=nt>&quot;name&quot;</span><span class=p>:</span> <span class=s2>&quot;optionalString&quot;</span><span class=p>,</span>
    <span class=err>[</span><span class=nt>&quot;null&quot;</span><span class=p>,</span> <span class=nt>&quot;string&quot;</span><span class=err>]</span>
<span class=p>}</span>
</code></pre></div> <p><strong>Rules</strong></p> <p>When a default value is specified for a record whose type is a <code>union</code>, the type of the default value must match the first element of the <code>union</code>.</p> <p>Thus for <code>unions</code> containing <code>null</code>, the <code>null</code> SHOULD be listed first since the default value of such <code>unions</code> is typically <code>null</code></p> <p><strong>Restrictions on Combining <code>unions</code></strong></p> <ul> <li><code>unions</code> may not immediately contain other <code>unions</code></li> <li><code>unions</code> may not contain more than one schema with the same type except for <code>record</code> types, <code>fixed</code> types and <code>enum</code> types<ul> <li><code>unions</code> containing two <code>array</code> types or two <code>map</code> types are not permitted, but two types with different names are permitted. This is because <em>names</em> permit efficient resolution when reading and writing <code>unions</code>.</li> </ul> </li> </ul> </details> <h4 id=fixed>Fixed<a class=headerlink href=#fixed title="Permanent link">&para;</a></h4> <details class=info open=open><summary>Fixed Types</summary><p><code>fixed</code> types are user-defined types where the specific number of bytes required to hold the type is explicitly declared. The number of bytes is specified as a positive integer.</p> <p><strong>Example: a 16-byte quantity for holding an md5 hash</strong></p> <div class=tabbed-set data-tabs=18:1><input checked=checked id=__tabbed_18_1 name=__tabbed_18 type=radio><label for=__tabbed_18_1>Avro IDL declaration for an MD5 hash type</label><div class=tabbed-content></div> </div> <div class=highlight><pre><span></span><code>    <span class=n>fixed</span> <span class=nf>MD5</span><span class=p>(</span><span class=mi>16</span><span class=p>);</span>
</code></pre></div> <div class=tabbed-set data-tabs=19:1><input checked=checked id=__tabbed_19_1 name=__tabbed_19 type=radio><label for=__tabbed_19_1>Equivalent Avro JSON schema</label><div class=tabbed-content></div> </div> <div class=highlight><pre><span></span><code>    <span class=p>{</span>
        <span class=nt>&quot;type&quot;</span><span class=p>:</span> <span class=s2>&quot;fixed&quot;</span><span class=p>,</span> 
        <span class=nt>&quot;size&quot;</span><span class=p>:</span> <span class=mi>16</span><span class=p>,</span> 
        <span class=nt>&quot;name&quot;</span><span class=p>:</span> <span class=s2>&quot;MD5&quot;</span>
    <span class=p>}</span>
</code></pre></div> </details> <h3 id=logical-types>Logical Types<a class=headerlink href=#logical-types title="Permanent link">&para;</a></h3> <p>A <code>logical</code> type is an Avro primitive or complex type with extra attributes to represent a derived type. </p> <p>The attribute <code>logicalType</code> must always be present for a <code>logical</code> type. It is a <code>string</code> representation of one of these <code>logical</code> types:</p> <ul> <li><code>decimal</code></li> <li><code>uuid</code> </li> <li><code>date</code> </li> <li><code>time-micros</code></li> <li><code>timestamp-micros</code></li> <li><code>time-millis</code> </li> <li><code>timestamp-millis</code> </li> </ul> <div class="admonition warning"> <p class=admonition-title>Only <code>timestamp-millis</code> and <code>time-millis</code> and <code>date</code> supported</p> <blockquote> <p>In the current implementation of the <em>Avro IDL</em>, only the <code>timestamp-millis</code>, <code>time-millis</code> and <code>date</code> <code>logicalType</code> are supported. The other <code>logicalTypes</code> are supported in Avro JSON schemas, but cannot be generated with the <em>Avro IDL</em>.</p> </blockquote> </div> <p><strong>Serialization of <code>logicalType</code></strong></p> <p>A <code>logical</code> type is always serialized using its underlying Avro type so that values are encoded in exactly the same way as the equivalent Avro type that does not have a <code>logicalType</code> attribute. </p> <p>Thus, if a <code>logical</code> type is invalid, for example a decimal with scale greater than its precision, then implementations COULD ignore the <code>logical</code> type and use the underlying Avro type.</p> <details class=warning><summary><code>Decimal</code> Logical Type Not Yet supported in <em>Avro IDL</em></summary><p>The <code>decimal</code> logical type represents an arbitrary-precision signed decimal number of the form:</p> <blockquote> <p>unscaled Ã— 10-scale.</p> </blockquote> <p><strong>Example: schema representing <code>decimal</code> numbers with a maximum precision of 4 and a scale of 2</strong></p> <div class=tabbed-set data-tabs=20:1><input checked=checked id=__tabbed_20_1 name=__tabbed_20 type=radio><label for=__tabbed_20_1>Avro IDL declaration for the decimal logical type</label><div class=tabbed-content></div> </div> <div class=highlight><pre><span></span><code>    <span class=n>decimal</span><span class=p>(</span><span class=mi>4</span><span class=p>,</span><span class=mi>2</span><span class=p>)</span> <span class=n>dailyEarnings</span><span class=p>;</span>
</code></pre></div> <div class=tabbed-set data-tabs=21:1><input checked=checked id=__tabbed_21_1 name=__tabbed_21 type=radio><label for=__tabbed_21_1>Equivalent Avro JSON schema</label><div class=tabbed-content></div> </div> <div class=highlight><pre><span></span><code>    <span class=p>{</span>
        <span class=nt>&quot;type&quot;</span><span class=p>:</span> <span class=s2>&quot;bytes&quot;</span><span class=p>,</span> <span class=err>//</span> <span class=err>underlying</span> <span class=err>Avro</span> <span class=err>type</span>
        <span class=nt>&quot;logicalType&quot;</span><span class=p>:</span> <span class=s2>&quot;decimal&quot;</span><span class=p>,</span>
        <span class=nt>&quot;name&quot;</span><span class=p>:</span> <span class=s2>&quot;dailyEarnings&quot;</span><span class=p>,</span>
        <span class=nt>&quot;precision&quot;</span><span class=p>:</span> <span class=mi>4</span><span class=p>,</span>
        <span class=nt>&quot;scale&quot;</span><span class=p>:</span> <span class=mi>2</span>
    <span class=p>}</span>
</code></pre></div> <table> <thead> <tr> <th>Attributes</th> <th>Required or Optional?</th> <th>Description</th> </tr> </thead> <tbody> <tr> <td><code>precision</code></td> <td>REQUIRED</td> <td>the MAXIMUM number of digits that can be represented, irrespective of the position of the decimal point</td> </tr> <tr> <td><code>scale</code></td> <td>OPTIONAL</td> <td>the number of fractional digits. If not specified, the <code>scale</code> is defined as <code>0</code></td> </tr> </tbody> </table> <p>Ex: Given the declaration:</p> <blockquote> <p><code>decimal(4) dailyEarnings;</code></p> </blockquote> <p>The following decimals are all valid:</p> <blockquote> <ul> <li>9999</li> <li>-9999</li> <li>... and all other digits between {-9999, 9999}</li> </ul> </blockquote> <div class="admonition tip"> <p class=admonition-title>A <code>scale</code> value of <code>0</code> resolves to integer values since there are no fractional digits</p> </div> <p><strong>Restrictions</strong></p> <ul> <li><code>precision</code> must be a positive integer (greater than zero). If the underlying type is a <code>fixed</code> type, then the precision is limited by its size</li> <li><code>scale</code> must be <code>0</code> or a positive integer less than or equal to the precision</li> </ul> <p>Ex: Given the declaration:</p> <blockquote> <p><code>decimal(4, 2) rideFees;</code></p> </blockquote> <p>The following decimals are all valid:</p> <blockquote> <ul> <li>99.99</li> <li>-99.99</li> <li>... and all other decimals between {-99.99, 99.99}</li> </ul> </blockquote> <div class="admonition tip"> <p class=admonition-title>A <code>scale</code> value equal to the <code>precision</code> value resolves to a decimal with only fractional digits</p> </div> <p>Ex: Given the declaration:</p> <blockquote> <p><code>decimal (4, 4) commission;</code></p> </blockquote> <p>The following decimals are valid:</p> <blockquote> <ul> <li>0.999</li> <li>-0.999</li> <li>... and all other decimals between {-0.999, 0.999}</li> </ul> </blockquote> <div class="admonition tip"> <p class=admonition-title>When resolving schemas, two schemas that are <code>decimal</code> logical types match if their scales and precisions match</p> </div> </details> <details class=warning><summary><code>UUID</code> Logical Type Not Yet supported in <em>Avro IDL</em></summary><p>The <code>uuid</code> logical type represents a random generated, universally unique identifier (UUID).</p> <p>It annotates an Avro <code>string</code> type that conforms with <a href=https://tools.ietf.org/html/rfc4122>RFC-4122</a></p> <p><strong>Example: named schema for representing a <em>user_id</em> with a <code>UUID</code> logical type</strong></p> <div class=tabbed-set data-tabs=22:1><input checked=checked id=__tabbed_22_1 name=__tabbed_22 type=radio><label for=__tabbed_22_1>Avro IDL declaration for a UUID logical type</label><div class=tabbed-content></div> </div> <div class=highlight><pre><span></span><code>    <span class=n>UUID</span> <span class=n>user_id</span><span class=p>;</span>
</code></pre></div> <div class=tabbed-set data-tabs=23:1><input checked=checked id=__tabbed_23_1 name=__tabbed_23 type=radio><label for=__tabbed_23_1>Equivalent Avro JSON schema</label><div class=tabbed-content></div> </div> <div class=highlight><pre><span></span><code><span class=p>{</span>
    <span class=nt>&quot;name&quot;</span><span class=p>:</span> <span class=s2>&quot;user_id&quot;</span><span class=p>,</span>
    <span class=nt>&quot;type&quot;</span><span class=p>:</span> <span class=s2>&quot;string&quot;</span><span class=p>,</span>
    <span class=nt>&quot;logicalType&quot;</span><span class=p>:</span> <span class=s2>&quot;UUID&quot;</span>
<span class=p>}</span>
</code></pre></div> </details> <details class=warning><summary><code>Date</code> Logical Type Not Yet supported in <em>Avro IDL</em></summary><p>The <code>date</code> logical type represents a date, with NO reference to time zone or time of day.</p> <p>It annotates an Avro <code>int</code> type, where the <code>int</code> stores the number of days from the unix epoch (1 January 1970 [ISO Calendar])</p> <p><strong>Example: named schema for representing April Fool's day with a <code>date</code> logical type</strong></p> <div class=tabbed-set data-tabs=24:1><input checked=checked id=__tabbed_24_1 name=__tabbed_24 type=radio><label for=__tabbed_24_1>Avro IDL declaration for a date logical type</label><div class=tabbed-content></div> </div> <div class=highlight><pre><span></span><code>    <span class=n>date</span> <span class=n>april_fools_day</span><span class=p>;</span>
</code></pre></div> <div class=tabbed-set data-tabs=25:1><input checked=checked id=__tabbed_25_1 name=__tabbed_25 type=radio><label for=__tabbed_25_1>Equivalent Avro JSON schema</label><div class=tabbed-content></div> </div> <div class=highlight><pre><span></span><code><span class=p>{</span>
    <span class=nt>&quot;name&quot;</span><span class=p>:</span> <span class=s2>&quot;april_fools_day&quot;</span><span class=p>,</span>
    <span class=nt>&quot;type&quot;</span><span class=p>:</span> <span class=s2>&quot;int&quot;</span><span class=p>,</span>
    <span class=nt>&quot;logicalType&quot;</span><span class=p>:</span> <span class=s2>&quot;date&quot;</span>
<span class=p>}</span>
</code></pre></div> </details> <details class=info open=open><summary>Logical Types for representing <code>Time</code></summary><table> <thead> <tr> <th>Logical Type</th> <th>Precision</th> <th>Underlying Avro Type</th> <th>Storage</th> <th>Description</th> </tr> </thead> <tbody> <tr> <td><code>time-millis</code></td> <td>1 millisecond</td> <td><code>int</code></td> <td>number of <strong>milliseconds</strong> after midnight, 00:00:00.000</td> <td>represents a time of day, with no reference to a particular calendar, time zone or date</td> </tr> <tr> <td><code>time-micros</code></td> <td>1 microsecond</td> <td><code>long</code></td> <td>numer of <strong>microseconds</strong> after midnight, 00:00:00.000000</td> <td>represents a time of day, with no reference to a particular calendar, time zone or date</td> </tr> <tr> <td><code>timestamp-millis</code></td> <td>1 millisecond</td> <td><code>long</code></td> <td>number of <strong>milliseconds</strong> from the unix epoch, 1 January 1970 00:00:00.000 UTC</td> <td>represents an instant on the global timeline, independent of a particular time zone or calendar</td> </tr> <tr> <td><code>timestamp-micros</code></td> <td>1 microsecond</td> <td><code>long</code></td> <td>number of <strong>microseconds</strong> from the unix epoch, 1 January 1970 00:00:00.000000 UTC</td> <td>represents an instant on the global timeline, independent of a particular time zone or calendar</td> </tr> </tbody> </table> <p><strong>Example: named timestamp for representing the time a user account was created, using a <code>timestamp-millis</code> logical type</strong></p> <div class=tabbed-set data-tabs=26:1><input checked=checked id=__tabbed_26_1 name=__tabbed_26 type=radio><label for=__tabbed_26_1>Avro IDL declaration for a timestamp-millis logical type</label><div class=tabbed-content></div> </div> <div class=highlight><pre><span></span><code>    <span class=n>timestamp</span><span class=o>-</span><span class=n>millis</span> <span class=n>created_at</span><span class=p>;</span>
</code></pre></div> <div class=tabbed-set data-tabs=27:1><input checked=checked id=__tabbed_27_1 name=__tabbed_27 type=radio><label for=__tabbed_27_1>Equivalent Avro JSON schema</label><div class=tabbed-content></div> </div> <div class=highlight><pre><span></span><code><span class=p>{</span>
    <span class=nt>&quot;name&quot;</span><span class=p>:</span> <span class=s2>&quot;created_at&quot;</span><span class=p>,</span>
    <span class=nt>&quot;type&quot;</span><span class=p>:</span> <span class=s2>&quot;long&quot;</span><span class=p>,</span>
    <span class=nt>&quot;logicalType&quot;</span><span class=p>:</span> <span class=s2>&quot;timestamp-millis&quot;</span>
<span class=p>}</span>
</code></pre></div> <div class="admonition warning"> <p class=admonition-title><code>timestamp-micros</code> and <code>time-micros</code> not currently supported in Avro-IDL.</p> <p>Use a custom annotation instead such as:</p> <div class=highlight><pre><span></span><code>    <span class=err>@</span><span class=n>serviceTimeStamp</span><span class=p>(</span><span class=s>&quot;timestamp-micros&quot;</span><span class=p>)</span> <span class=c1>// using a custom annotation to specify timestamp-micros</span>
    <span class=kt>long</span> <span class=n>CreatedAt</span><span class=p>;</span>
</code></pre></div> </div> </details> <h2 id=naming-conventions>Naming Conventions<a class=headerlink href=#naming-conventions title="Permanent link">&para;</a></h2> <h3 id=named-types>Named Types<a class=headerlink href=#named-types title="Permanent link">&para;</a></h3> <details class=info open=open><summary>Defining <em>named</em> types</summary><p><code>records</code>, <code>enums</code>, and <code>fixed</code> types are <em>named</em> types, where each <em>fullname</em> consists of:</p> <ul> <li><code>name</code>: starts with characters that match <code>[A-Za-z_]</code>, and CAN subsequently contain characters that match <code>[A-Za-z0-9_]</code></li> <li><code>namespace</code>: dot-separated sequence of <em>name</em>-like tokens that qualify a <em>name</em>. The empty string can be used to indicate the null namespace</li> </ul> <p><strong>Restrictions</strong></p> <ul> <li>The uniqueness of the <em>name</em> associated with a <em>named</em> type is defined on the <em>fullname</em></li> <li>The check for equality on <em>names</em> (including <code>field</code> names and <code>enum</code> symbols) is case-sensitive</li> <li>A schema may not contain multiple definitions of a <em>fullname</em></li> <li>A <em>name</em> must be defined before it is used</li> </ul> </details> <h3 id=aliases>Aliases<a class=headerlink href=#aliases title="Permanent link">&para;</a></h3> <details class=info open=open><summary>Using <code>aliases</code> for <em>named</em> types and <code>fields</code></summary><p><em>Aliases</em> provide a mechanism for flexibility when declaring a schema. They allow named types and fields to be optionally mapped to other named types and fields, which makes it easier for schemas to evolve.</p> <p><strong>Example: specifying <code>type</code> and <code>field</code> aliases, using the <code>@alias</code> annotation</strong></p> <div class=highlight><pre><span></span><code><span class=err>@</span><span class=n>aliases</span><span class=p>([</span><span class=s>&quot;OldRecord&quot;</span><span class=p>,</span> <span class=s>&quot;AncientRecord&quot;</span><span class=p>])</span>
<span class=n>record</span> <span class=n>MyRecord</span> <span class=p>{</span> <span class=c1>// map the named record type `MyRecord` to `OldRecord` and `AncientRecord`</span>
    <span class=n>string</span> <span class=err>@</span><span class=n>aliases</span><span class=p>([</span><span class=s>&quot;oldField&quot;</span><span class=p>,</span> <span class=s>&quot;ancientField&quot;</span><span class=p>])</span> <span class=n>myNewField</span><span class=p>;</span> <span class=c1>// map the record&#39;s string field `myNewField` to `oldField` and `ancientField`</span>
<span class=p>}</span>
</code></pre></div> <p>Consequently, the named record type <code>MyRecord</code> can also be referenced as <code>OldRecord</code> or <code>AncientRecord</code>. </p> <p>Similarly, <code>MyRecord</code>'s named string field <code>myNewField</code> can also be referenced as <code>oldField</code> or <code>ancientField</code>.</p> <p>In the context of event driven applications, this means that <em>producers</em> can safely update the schemas, without worrying about introducing breaking changes for the <em>consumers</em>, since aliases provide a mechanism for backwards compatibility.</p> </details> <h2 id=annotations-comments-and-other-language-constructs>Annotations, Comments and Other Language Constructs<a class=headerlink href=#annotations-comments-and-other-language-constructs title="Permanent link">&para;</a></h2> <p>The annotation tag (<code>@</code>) is used to specify certain properties of the annotated element.</p> <p>Here are some common annotations:</p> <table> <thead> <tr> <th>annotation</th> <th>description</th> </tr> </thead> <tbody> <tr> <td><code>@namespace</code></td> <td>specify <code>namespace</code> of a <code>record</code>, or modify the <code>namespace</code> when defininig a named schema</td> </tr> <tr> <td><code>@aliases</code></td> <td>specify <code>type</code> and <code>field</code> aliases of a <code>record</code></td> </tr> </tbody> </table> <details class=info open=open><summary>Examples of annotations</summary><p><strong>Modify the <code>namespace</code> when defining a <em>named</em> schema, using the <code>@namespace</code> annotation</strong></p> <div class=highlight><pre><span></span><code>    <span class=err>@</span><span class=k>namespace</span><span class=p>(</span><span class=s>&quot;legacy.bookkeeping&quot;</span><span class=p>)</span>
    <span class=n>protocol</span> <span class=n>transaction_created</span> <span class=p>{</span>
        <span class=err>@</span><span class=k>namespace</span><span class=p>(</span><span class=s>&quot;current.bookkeeping&quot;</span><span class=p>)</span>
        <span class=n>record</span> <span class=n>current_transaction</span> <span class=p>{}</span>

        <span class=n>record</span> <span class=n>legacy_transaction</span> <span class=p>{}</span>
    <span class=p>}</span>
</code></pre></div> <p>where the <code>transaction_created</code> <em>protocol</em> is defined in the <code>legacy.bookkeeping</code> namespace, the <em>record</em> <code>current_transaction</code> is defined in the <code>current.bookkeeping</code> namespace and the <em>record</em> <code>legacy_transaction</code> is defined in the <code>legacy.bookkeeping</code> namespace, since it inherits its default <em>namespace</em> from its container.</p> <div class="admonition tip"> <p class=admonition-title>annotations can be used to include arbitrary JSON elements</p> <blockquote> <p>JSON elements that are not directly supported in the <em>Avro IDL</em>, such as service-specific metadata, or certain logical types such as <code>timestamp-micros</code> can be declared using annotation tags.</p> </blockquote> </div> <p>For example:</p> <div class=tabbed-set data-tabs=28:1><input checked=checked id=__tabbed_28_1 name=__tabbed_28 type=radio><label for=__tabbed_28_1>Declaring a service-specific timestamp using annotations</label><div class=tabbed-content></div> </div> <div class=highlight><pre><span></span><code><span class=err>@</span><span class=n>serviceTimeStamp</span><span class=p>(</span><span class=s>&quot;timestamp-micros&quot;</span><span class=p>)</span> <span class=c1>// using the generic annotation to specify timestamp-micros</span>
<span class=kt>long</span> <span class=n>CreatedAt</span><span class=p>;</span>
</code></pre></div> <div class=tabbed-set data-tabs=29:1><input checked=checked id=__tabbed_29_1 name=__tabbed_29 type=radio><label for=__tabbed_29_1>Equivalent Avro JSON format</label><div class=tabbed-content></div> </div> <div class=highlight><pre><span></span><code><span class=p>{</span>
    <span class=nt>&quot;name&quot;</span> <span class=p>:</span> <span class=s2>&quot;CreatedAt&quot;</span><span class=p>,</span>
    <span class=nt>&quot;type&quot;</span> <span class=p>:</span> <span class=p>{</span>
    <span class=nt>&quot;type&quot;</span> <span class=p>:</span> <span class=s2>&quot;long&quot;</span><span class=p>,</span>
    <span class=nt>&quot;serviceTimeStamp&quot;</span> <span class=p>:</span> <span class=s2>&quot;timestamp-micros&quot;</span>
    <span class=p>}</span>
<span class=p>}</span>
</code></pre></div> </details> <p><strong>Comments</strong></p> <p>The <em>Avro IDL</em> supports <code>C</code>-style comments, where:</p> <ul> <li>any text following <code>//</code> on a line is ignored</li> <li>any text between <code>/*</code> and <code>*/</code> (possibly spanning multiple lines) is ignored</li> </ul> <p><strong>Using reserved language keywords as identifiers</strong></p> <p>In the rare occasion that a reserved language keyword needs to be used as an identifier, the backtick character `` can be wrapped around the keyword.</p> <blockquote> <p>error =&gt; `error`</p> </blockquote> <h2 id=schema-imports-and-references-to-named-schemas>Schema Imports and References to Named Schemas<a class=headerlink href=#schema-imports-and-references-to-named-schemas title="Permanent link">&para;</a></h2> <p>When authoring schemas, files may be imported using the <code>import</code> directive as follows:</p> <ul> <li><code>import idl "foo.avdl"</code> to import an IDL schema</li> <li><code>import schema "foo.avsc"</code> to import a JSON schema</li> </ul> <p>Imported file names are resolved relative to the current IDL file</p> <details class=info open=open><summary>References to Named Schemas and Types</summary><p>If a named type has already been defined or imported in the same Avro IDL file, it may be referenced by name, as if it were a primitive type. </p> <p>Example: </p> <p>Given a schema specifying a suit of cards:</p> <div class=highlight><pre><span></span><code><span class=k>enum</span> <span class=n>Suit</span> <span class=p>{</span>
<span class=n>SPADES</span><span class=p>,</span> <span class=n>HEARTS</span><span class=p>,</span> <span class=n>DIAMONDS</span><span class=p>,</span> <span class=n>CLUBS</span>
<span class=p>}</span>
</code></pre></div> <p>It can be referenced in a schema specifying a card as:</p> <div class=highlight><pre><span></span><code><span class=n>record</span> <span class=n>Card</span> <span class=p>{</span>
<span class=n>Suit</span> <span class=n>suit</span><span class=p>;</span> <span class=c1>// refers to the enum Card defined above</span>
<span class=kt>int</span> <span class=n>number</span><span class=p>;</span>
<span class=p>}</span>
</code></pre></div> </details> <p>That's it! You now have all the information needed to author schemas using the <em>Avro IDL</em>. Take a glance at the <a href=#usage>usage</a> section if you're not sure where to begin.</p> <p><img alt src=../images/architecture-avro-idl-schema.png></p> <h2 id=references>References<a class=headerlink href=#references title="Permanent link">&para;</a></h2> <ul> <li><a href=http://avro.apache.org/docs/current/index.html>Apache Avro Documentation</a></li> <li><a href=http://avro.apache.org/docs/current/spec.html>Avro Specification</a></li> <li><a href=http://avro.apache.org/docs/current/idl.html>Avro IDL</a></li> </ul> <details class=tip open=open><summary>Need help?</summary><ul> <li>Post your question on these Slack channels:</li> <li>Dev Go Talk @ <code>#dev-go-talk</code></li> </ul> <p><strong>Did you find this page useful?</strong></p> <p><img alt=ðŸ˜ class=twemoji src=https://twemoji.maxcdn.com/v/latest/svg/1f60d.svg title=:heart_eyes:> <a href=https://forms.gle/bMu4PvHKzS2JqcVN9><strong>Yes!</strong></a></p> <p><img alt=ðŸ˜¢ class=twemoji src=https://twemoji.maxcdn.com/v/latest/svg/1f622.svg title=:cry:> <a href=https://forms.gle/UvsrHfZBevR2rSP36><strong>No</strong></a></p> </details> <p><strong>Maintained by:</strong> Kelvin Spencer</p> <hr> <div class=md-source-date> <small> Last update: June 3, 2020 </small> </div> </article> </div> </div> </main> <footer class=md-footer> <div class=md-footer-nav> <nav class="md-footer-nav__inner md-grid" aria-label=Footer> <a href=../getting-started-with-cuelang/ title=Cuelang class="md-footer-nav__link md-footer-nav__link--prev" rel=prev> <div class="md-footer-nav__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </div> <div class=md-footer-nav__title> <div class=md-ellipsis> <span class=md-footer-nav__direction> Previous </span> Cuelang </div> </div> </a> </nav> </div> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-footer-copyright> <div class=md-footer-copyright__highlight> Copyright &copy; 2019 - 2020 Kelvin Spencer </div> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> </div> </div> </footer> </div> <script src=../assets/javascripts/vendor.d710d30a.min.js></script> <script src=../assets/javascripts/bundle.5f27aba8.min.js></script><script id=__lang type=application/json>{"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents"}</script> <script>
        app = initialize({
          base: "..",
          features: ["instant", "tabs"],
          search: Object.assign({
            worker: "../assets/javascripts/worker/search.27c6a5e6.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script> </body> </html>