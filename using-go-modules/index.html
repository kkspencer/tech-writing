<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=author content="Kelvin Spencer"><link rel="shortcut icon" href=/images/logo.png><meta name=generator content="mkdocs-1.1.2, mkdocs-material-5.2.2"><title>Go Modules - Tech Writing</title><link rel=stylesheet href=../assets/stylesheets/main.a2408e81.min.css><link rel=stylesheet href=../assets/stylesheets/palette.a46bcfb3.min.css><meta name=theme-color content><link href=https://fonts.gstatic.com rel=preconnect crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Ubuntu:300,400,400i,700%7CUbuntu+Mono&display=fallback"><style>body,input{font-family:"Ubuntu",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Ubuntu Mono",SFMono-Regular,Consolas,Menlo,monospace}</style><link rel=manifest href=../manifest.webmanifest crossorigin=use-credentials></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary=white data-md-color-accent=pink> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#introduction class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <header class=md-header data-md-component=header> <nav class="md-header-nav md-grid" aria-label=Header> <a href=.. title="Tech Writing" class="md-header-nav__button md-logo" aria-label="Tech Writing"> <img src=/images/logo.png alt=logo> </a> <label class="md-header-nav__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg> </label> <div class=md-header-nav__title data-md-component=header-title> <div class=md-header-nav__ellipsis> <span class="md-header-nav__topic md-ellipsis"> Tech Writing </span> <span class="md-header-nav__topic md-ellipsis"> Go Modules </span> </div> </div> <label class="md-header-nav__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query data-md-state=active> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </label> <button type=reset class="md-search__icon md-icon" aria-label=Clear data-md-component=search-reset tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg> </button> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list></ol> </div> </div> </div> </div> </div> </nav> </header> <div class=md-container data-md-component=container> <nav class=md-tabs aria-label=Tabs data-md-component=tabs> <div class="md-tabs__inner md-grid"> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=.. class="md-tabs__link md-tabs__link--active"> Home </a> </li> </ul> </div> </nav> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=.. title="Tech Writing" class="md-nav__button md-logo" aria-label="Tech Writing"> <img src=/images/logo.png alt=logo> </a> Tech Writing </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=.. title=Home class=md-nav__link> Home </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" data-md-toggle=toc type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> Go Modules <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 9h14V7H3v2m0 4h14v-2H3v2m0 4h14v-2H3v2m16 0h2v-2h-2v2m0-10v2h2V7h-2m0 6h2v-2h-2v2z"/></svg> </span> </label> <a href=./ title="Go Modules" class="md-nav__link md-nav__link--active"> Go Modules </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> Table of contents </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=#introduction class=md-nav__link> Introduction </a> </li> <li class=md-nav__item> <a href=#what-are-go-modules class=md-nav__link> What are Go Modules? </a> </li> <li class=md-nav__item> <a href=#why-go-modules class=md-nav__link> Why Go Modules? </a> </li> <li class=md-nav__item> <a href=#why-semantic-import-versioning class=md-nav__link> Why Semantic Import Versioning? </a> </li> <li class=md-nav__item> <a href=#how-are-the-module-versions-to-use-in-each-build-determined class=md-nav__link> How are the module versions to use in each build determined? </a> </li> <li class=md-nav__item> <a href=#how-does-the-minimal-version-selection-mvs-algorithm-construct-the-build-list-for-a-given-module class=md-nav__link> How does the Minimal Version Selection (MVS) algorithm construct the build list for a given module? </a> </li> <li class=md-nav__item> <a href=#how-does-the-mvs-algorithm-upgrade-all-modules-to-their-latest-version class=md-nav__link> How does the MVS algorithm upgrade all modules to their latest version? </a> </li> <li class=md-nav__item> <a href=#how-does-the-mvs-algorithm-upgrade-one-module-to-a-specific-newer-version class=md-nav__link> How does the MVS algorithm upgrade one module to a specific newer version? </a> </li> <li class=md-nav__item> <a href=#how-does-the-mvs-algorithm-downgrade-one-module-to-a-specific-older-version class=md-nav__link> How does the MVS algorithm downgrade one module to a specific older version? </a> </li> <li class=md-nav__item> <a href=#what-advantage-does-this-have-over-systems-that-use-lock-files class=md-nav__link> What advantage does this have over systems that use lock files? </a> </li> <li class=md-nav__item> <a href=#why-does-using-go-modules-make-vendoring-unnecessary class=md-nav__link> Why does using Go Modules make vendoring unnecessary? </a> </li> <li class=md-nav__item> <a href=#why-are-pseudo-versions-used-to-identify-untagged-commits class=md-nav__link> Why are pseudo-versions used to identify untagged commits? </a> </li> <li class=md-nav__item> <a href=#can-i-use-go-modules-along-with-the-traditional-gopath-based-mechanisms class=md-nav__link> Can I use Go Modules along with the traditional GOPATH-based mechanisms? </a> </li> <li class=md-nav__item> <a href=#how-can-i-make-the-current-directory-the-root-of-a-module class=md-nav__link> How can I make the current directory, the root of a module? </a> </li> <li class=md-nav__item> <a href=#can-packages-also-have-gomod-files class=md-nav__link> Can packages also have go.mod files? </a> </li> <li class=md-nav__item> <a href=#what-happens-if-a-package-is-not-provided-by-any-module-in-gomod class=md-nav__link> What happens if a package is not provided by any module in go.mod? </a> </li> <li class=md-nav__item> <a href=#can-modules-be-cached-locally class=md-nav__link> Can modules be cached locally? </a> </li> <li class=md-nav__item> <a href=#how-are-different-major-versions-of-package-distinguished class=md-nav__link> How are different major versions of package distinguished? </a> </li> <li class=md-nav__item> <a href=#can-i-build-a-program-using-different-minor-versions class=md-nav__link> Can I build a program using different minor versions? </a> </li> <li class=md-nav__item> <a href=#how-do-i-clean-up-unused-dependencies class=md-nav__link> How do I clean up unused dependencies? </a> </li> <li class=md-nav__item> <a href=#what-does-go-mod-tidy-do class=md-nav__link> What does go mod tidy do? </a> </li> <li class=md-nav__item> <a href=#i-get-errors-when-i-run-go-mod-tidy-what-could-it-be class=md-nav__link> I get errors when I run go mod tidy, what could it be? </a> </li> <li class=md-nav__item> <a href=#how-can-i-fix-tests-that-are-failing-because-they-cannot-write-files-in-the-package-directory class=md-nav__link> How can I fix tests that are failing because they cannot write files in the package directory? </a> </li> <li class=md-nav__item> <a href=#how-can-i-fix-tests-that-are-failing-because-they-rely-on-relative-paths-to-packages-in-another-module class=md-nav__link> How can I fix tests that are failing because they rely on relative paths to packages in another module </a> </li> <li class=md-nav__item> <a href=#how-can-i-fix-tests-that-are-failing-becase-they-expect-go-commands-within-the-test-to-run-in-gopath-mode class=md-nav__link> How can I fix tests that are failing becase they expect go commands within the test to run in $GOPATH mode? </a> </li> <li class=md-nav__item> <a href=#how-do-i-release-a-new-module-after-committing-my-changes class=md-nav__link> How do I release a new module after committing my changes? </a> </li> <li class=md-nav__item> <a href=#how-do-i-know-which-environment-variable-to-use-when-working-with-go-modules class=md-nav__link> How do I know which environment variable to use when working with Go Modules? </a> </li> <li class=md-nav__item> <a href=#help-my-build-is-failing-and-i-dont-know-where-to-start class=md-nav__link> Help! My build is failing and I don't know where to start! </a> </li> <li class=md-nav__item> <a href=#reference class=md-nav__link> Reference </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../getting-started-with-cuelang/ title=Cuelang class=md-nav__link> Cuelang </a> </li> <li class=md-nav__item> <a href=../authoring-schemas-with-avro-idl/ title="Avro IDL" class=md-nav__link> Avro IDL </a> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> Table of contents </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=#introduction class=md-nav__link> Introduction </a> </li> <li class=md-nav__item> <a href=#what-are-go-modules class=md-nav__link> What are Go Modules? </a> </li> <li class=md-nav__item> <a href=#why-go-modules class=md-nav__link> Why Go Modules? </a> </li> <li class=md-nav__item> <a href=#why-semantic-import-versioning class=md-nav__link> Why Semantic Import Versioning? </a> </li> <li class=md-nav__item> <a href=#how-are-the-module-versions-to-use-in-each-build-determined class=md-nav__link> How are the module versions to use in each build determined? </a> </li> <li class=md-nav__item> <a href=#how-does-the-minimal-version-selection-mvs-algorithm-construct-the-build-list-for-a-given-module class=md-nav__link> How does the Minimal Version Selection (MVS) algorithm construct the build list for a given module? </a> </li> <li class=md-nav__item> <a href=#how-does-the-mvs-algorithm-upgrade-all-modules-to-their-latest-version class=md-nav__link> How does the MVS algorithm upgrade all modules to their latest version? </a> </li> <li class=md-nav__item> <a href=#how-does-the-mvs-algorithm-upgrade-one-module-to-a-specific-newer-version class=md-nav__link> How does the MVS algorithm upgrade one module to a specific newer version? </a> </li> <li class=md-nav__item> <a href=#how-does-the-mvs-algorithm-downgrade-one-module-to-a-specific-older-version class=md-nav__link> How does the MVS algorithm downgrade one module to a specific older version? </a> </li> <li class=md-nav__item> <a href=#what-advantage-does-this-have-over-systems-that-use-lock-files class=md-nav__link> What advantage does this have over systems that use lock files? </a> </li> <li class=md-nav__item> <a href=#why-does-using-go-modules-make-vendoring-unnecessary class=md-nav__link> Why does using Go Modules make vendoring unnecessary? </a> </li> <li class=md-nav__item> <a href=#why-are-pseudo-versions-used-to-identify-untagged-commits class=md-nav__link> Why are pseudo-versions used to identify untagged commits? </a> </li> <li class=md-nav__item> <a href=#can-i-use-go-modules-along-with-the-traditional-gopath-based-mechanisms class=md-nav__link> Can I use Go Modules along with the traditional GOPATH-based mechanisms? </a> </li> <li class=md-nav__item> <a href=#how-can-i-make-the-current-directory-the-root-of-a-module class=md-nav__link> How can I make the current directory, the root of a module? </a> </li> <li class=md-nav__item> <a href=#can-packages-also-have-gomod-files class=md-nav__link> Can packages also have go.mod files? </a> </li> <li class=md-nav__item> <a href=#what-happens-if-a-package-is-not-provided-by-any-module-in-gomod class=md-nav__link> What happens if a package is not provided by any module in go.mod? </a> </li> <li class=md-nav__item> <a href=#can-modules-be-cached-locally class=md-nav__link> Can modules be cached locally? </a> </li> <li class=md-nav__item> <a href=#how-are-different-major-versions-of-package-distinguished class=md-nav__link> How are different major versions of package distinguished? </a> </li> <li class=md-nav__item> <a href=#can-i-build-a-program-using-different-minor-versions class=md-nav__link> Can I build a program using different minor versions? </a> </li> <li class=md-nav__item> <a href=#how-do-i-clean-up-unused-dependencies class=md-nav__link> How do I clean up unused dependencies? </a> </li> <li class=md-nav__item> <a href=#what-does-go-mod-tidy-do class=md-nav__link> What does go mod tidy do? </a> </li> <li class=md-nav__item> <a href=#i-get-errors-when-i-run-go-mod-tidy-what-could-it-be class=md-nav__link> I get errors when I run go mod tidy, what could it be? </a> </li> <li class=md-nav__item> <a href=#how-can-i-fix-tests-that-are-failing-because-they-cannot-write-files-in-the-package-directory class=md-nav__link> How can I fix tests that are failing because they cannot write files in the package directory? </a> </li> <li class=md-nav__item> <a href=#how-can-i-fix-tests-that-are-failing-because-they-rely-on-relative-paths-to-packages-in-another-module class=md-nav__link> How can I fix tests that are failing because they rely on relative paths to packages in another module </a> </li> <li class=md-nav__item> <a href=#how-can-i-fix-tests-that-are-failing-becase-they-expect-go-commands-within-the-test-to-run-in-gopath-mode class=md-nav__link> How can I fix tests that are failing becase they expect go commands within the test to run in $GOPATH mode? </a> </li> <li class=md-nav__item> <a href=#how-do-i-release-a-new-module-after-committing-my-changes class=md-nav__link> How do I release a new module after committing my changes? </a> </li> <li class=md-nav__item> <a href=#how-do-i-know-which-environment-variable-to-use-when-working-with-go-modules class=md-nav__link> How do I know which environment variable to use when working with Go Modules? </a> </li> <li class=md-nav__item> <a href=#help-my-build-is-failing-and-i-dont-know-where-to-start class=md-nav__link> Help! My build is failing and I don't know where to start! </a> </li> <li class=md-nav__item> <a href=#reference class=md-nav__link> Reference </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content> <article class="md-content__inner md-typeset"> <h1>Go Modules</h1> <h2 id=introduction>Introduction<a class=headerlink href=#introduction title="Permanent link">&para;</a></h2> <p>The aim of this guide is to provide just enough detail to get you productive when working with <a href=https://golang.org/cmd/go/#hdr-Modules__module_versions__and_more>Go Modules</a>. It is derived from a <a href=https://research.swtch.com/vgo>series of articles on Go Modules, written by Russ Cox</a>, the creator of Go Modules.</p> <p>If you would like to delve deeper into the design considerations behind Go Modules, please refer to the <a href=https://go.googlesource.com/proposal/+/master/design/24301-versioned-go.md>Go Modules Proposal</a>.</p> <p>If you would like to learn about all the commands, flags and options related to Go Modules, then the <a href=https://golang.org/cmd/go/#hdr-Modules__module_versions__and_more>Go Documentation</a> and the <a href=https://blog.golang.org/using-go-modules>Go blog articles on Go Modules</a> may be the right place to start.</p> <details class=tip open=open><summary>Spare me the lecture. I need to quickly learn how to:</summary><ul> <li><a href=#how-can-i-make-the-current-directory-the-root-of-a-module>make the current directory the root of a module</a></li> <li><a href=https://golang.org/cmd/go/#hdr-Add_dependencies_to_current_module_and_install_them>add a dependency</a></li> <li><a href=#how-does-the-mvs-algorithm-upgrade-one-module-to-a-specific-newer-version>set a dependency to a specific version(upgrade/downgrade)</a></li> <li><a href=#how-does-the-mvs-algorithm-upgrade-all-modules-to-their-latest-version>update all dependencies</a></li> <li><a href=#how-do-i-clean-up-unused-dependencies>clean up unused dependencies</a></li> <li><a href=#how-do-i-know-which-environment-variable-to-use-when-working-with-go-modules>set up the correct environment variables</a></li> <li><a href=#help-my-build-is-failing-and-i-dont-know-where-to-start>fix my failing builds</a></li> </ul> </details> <h2 id=what-are-go-modules>What are Go Modules?<a class=headerlink href=#what-are-go-modules title="Permanent link">&para;</a></h2> <p>In Go, programs are constructed by linking together packages. A package is built from one or more source files that together declare the <code>constants</code>, <code>types</code>, <code>variables</code> and <code>functions</code> that belong to it. These declarations are accessible by all files of the same package, and also exported for use in other packages.</p> <p>Go Modules introduce the concept of a module, defined as a collection of Go packages that are stored in a file tree, with a <a href=https://golang.org/pkg/cmd/go/#hdr-The_go_mod_file><code>go.mod</code></a> file at its root. This <code>go.mod</code> file defines the path for accessing the module (serving as its <a href=https://golang.org/cmd/go/#hdr-Import_path_syntax>import path</a>) and lists the module's dependency requirements, which are the other modules needed to successfully build the module. </p> <p>Each dependency is written as a module path and a specific semantic version, in a <a href=https://golang.org/cmd/go/#hdr-Module_compatibility_and_semantic_versioning>semantic version string</a> format.</p> <p>Concretely, a Go Module is a group of packages versioned as a single unit, with a <code>go.mod</code> file that declares the minimum requirements that must be satisfied by the module's dependencies, and where the group of packages share a common import path prefix.</p> <p>In addition to <code>go.mod</code>, Go Modules introduce a <a href=https://golang.org/pkg/cmd/go/#hdr-Module_authentication_using_go_sum><code>go.sum</code></a> file, which contains the cryptographic hashes of the content of specific module versions. When Go downloads each module, it computes a hash of the file tree corresponding to that module. The hash and the version of the module are included in the binary. The Go command then uses the <code>go.sum</code> file to ensure that future downloads of a module retrieve the same bits as the first download, thus guaranteeing that the modules a project depends on, do not change unexpectedly. Additionally, Go Modules introduce an <a href=https://go.googlesource.com/proposal/+/master/design/25530-sumdb.md>auditable checksum database</a> which will be used by the <code>go</code> command to authenticate modules.</p> <h2 id=why-go-modules>Why Go Modules?<a class=headerlink href=#why-go-modules title="Permanent link">&para;</a></h2> <p>Go Modules bring package versioning to Go. Versioning enables reproducible builds by ensuring that a program builds exactly the same way tomorrow as it does today. Modules also adopt semantic versioning, eliminates vendoring, and deprecates <code>$GOPATH</code> in favor of a project-based workflow. </p> <p>Previously, when <code>go get</code> needed a package, it always fetched the latest copy, delegating the download and update operations to version control systems like Git. This meant that without a concept of versioning, <code>go get</code> could not convey to users any expectations about what kind of changes to expect in a given update. With versioning, library writers and users can frame the expectation around updates. Consequently there is a clear expectation on breaking updates versus non-breaking updates. </p> <h2 id=why-semantic-import-versioning>Why Semantic Import Versioning?<a class=headerlink href=#why-semantic-import-versioning title="Permanent link">&para;</a></h2> <p>Go Modules champion the <em>Import Compatibility Rule</em>, where the expectation is that newer versions of a package, with a given import path, should be backwards-compatible with older versions. </p> <p>If an old package and a new package have the same import path, then the new package must be backwards compatible with the old package.</p> <ul> <li>ex: "github.com/foo/foo_package@v1.2.3" =&gt; "github.com/foo/foo_package@1.2.5"</li> </ul> <p>If a breaking change is required, then a new package should be created with a new import path.</p> <ul> <li>ex: "github.com/foo/foo_package@v1.2.3" =&gt; "github.com/foo/foo_package/v2@v2.0.0"</li> </ul> <p>Because each major version has a different import path, a module can contain one of each major version of a package. This means modules need to specify only the minimum requirements for their dependencies. Further, since both v1 and v2 of a package can coexist, this makes it easy to upgrade the clients of a package one at a time while guaranteeing successful builds. v0 is special because of its special role in <a href=https://semver.org/#spec-item-11><em>Semantic Versioning Precedence Rules</em></a> where major versions &gt;=1 have different import paths.</p> <h2 id=how-are-the-module-versions-to-use-in-each-build-determined>How are the module versions to use in each build determined?<a class=headerlink href=#how-are-the-module-versions-to-use-in-each-build-determined title="Permanent link">&para;</a></h2> <p>Go Modules use the <a href=https://research.swtch.com/vgo-mvs><em>Minimal Version Selection</em></a> (MVS) algorithm to determine which module versions to use in each build. A build of a module by itself uses the specific versions of required dependencies listed in the go.mod file. </p> <p>However, in larger builds, it only uses a newer version if a dependency in the build requires it. <a href=https://research.swtch.com/vgo-mvs><em>Minimal Version Selection</em></a> always selects the minimal (oldest) module version that satisfies the overall requirements of a build. Thus, the release of a new version has no effect on the build.</p> <ol> <li>It assumes that each module declares its own dependency requirements (as a list of the minimum versions of other modules)</li> <li>It assumes that modules follow the <a href=https://research.swtch.com/vgo-import><em>Import Compatibility Rule</em></a> where packages in newer versions should work as well as the older versions.</li> </ol> <p>As such, the dependency requirement guarantees only a minimum version, never a maximum version or a list of incompatible later versions.</p> <h2 id=how-does-the-minimal-version-selection-mvs-algorithm-construct-the-build-list-for-a-given-module>How does the Minimal Version Selection (MVS) algorithm construct the build list for a given module?<a class=headerlink href=#how-does-the-minimal-version-selection-mvs-algorithm-construct-the-build-list-for-a-given-module title="Permanent link">&para;</a></h2> <p>To construct the build list for a given module, the MVS algorithm starts the list with the module itself, and then appends each dependency's own build list. If a module appears in the list multiple times, it keeps only the newest module version. </p> <p>The build list is constructed using a graph reachability algorithm, with the given module as the starting node. The algorithm recursively traverses the graph, taking care not to visit a node that has already been visited. Once the traversal is complete (once it has a rough build list of nodes, including nodes with multiple versions), it computes the final build list by keeping only the newest version of any listed module. All other versions in the rough build list are discarded.</p> <h2 id=how-does-the-mvs-algorithm-upgrade-all-modules-to-their-latest-version>How does the MVS algorithm upgrade all modules to their latest version?<a class=headerlink href=#how-does-the-mvs-algorithm-upgrade-all-modules-to-their-latest-version title="Permanent link">&para;</a></h2> <p>To upgrade all modules to their latest versions, the MVS algorithm computes an upgraded build list by updating the module requirement graph so that every outbound link to any version of a module is replaced with one that links to the latest version of that module. It then uses the <a href=#how-does-the-minimal-version-selection-mvs-algorithm-construct-the-build-list-for-a-given-module>previous algorithm</a> to determine the final build list.</p> <p><strong>Commands:</strong></p> <ul> <li><code>go get -u</code>(without any arguments) =&gt; upgrade direct and indirect dependencies of the current package</li> <li><code>go get -u ./...</code> (from the module root) =&gt; upgrade all direct and indirect dependencies of your module, excluding test dependencies</li> <li><code>go get -u=patch ./...</code>(from the module root) =&gt; same as above, using the latest patch release</li> <li><code>go get -u -t ./...</code>(from the module root) =&gt; upgrade all direct and indirect dependencies of your module, including test dependencies</li> <li><code>go get -u=patch -t ./...</code>(from the module root) =&gt; same as above, using the latest patch release</li> <li><code>go get -u all</code> =&gt; update all of the packages transitively imported by the main module (including test dependencies)</li> <li><code>go get -u github.com/foo</code> =&gt; get the latest version of foo as well as the latest versions for all of the direct and indirect dependencies of <code>foo</code></li> </ul> <h2 id=how-does-the-mvs-algorithm-upgrade-one-module-to-a-specific-newer-version>How does the MVS algorithm upgrade one module to a specific newer version?<a class=headerlink href=#how-does-the-mvs-algorithm-upgrade-one-module-to-a-specific-newer-version title="Permanent link">&para;</a></h2> <p>To upgrade one module to a specific newer version, it first constructs the build list of the non-upgraded module as before. Then it appends the new module's build list. If a module appears in the list multiple times, it keeps only the newest module version.</p> <p><strong>Commands:</strong></p> <ul> <li><code>go get foo@v1.2.3</code> =&gt; get a specific version</li> <li><code>go get foo@latest</code> =&gt; get the latest version </li> <li><code>go get foo@master</code> =&gt; using a branch name such as <code>@master</code> obtains the latest commit regardless of whether or not it has a <a href=#why-semantic-import-versioning>semantic versioning tag</a></li> </ul> <details class=tip open=open><summary>Common Workflow</summary><p>A common starting point when upgrading <code>foo</code> is:</p> <div class=codehilite><pre><span></span><code>- `go get foo` or `go get foo@latest` and after things are working
- `go get -u=patch foo` to upgrade all direct and indirect dependencies of `foo`
</code></pre></div> </details> <h2 id=how-does-the-mvs-algorithm-downgrade-one-module-to-a-specific-older-version>How does the MVS algorithm downgrade one module to a specific older version?<a class=headerlink href=#how-does-the-mvs-algorithm-downgrade-one-module-to-a-specific-older-version title="Permanent link">&para;</a></h2> <p>To downgrade one module to a specific older version, it rewinds the required version of each top-level dependency, until that dependency's build list no longer refers to newer versions of the downgraded module. Downgrading one module may require downgrading other modules, so the algorithm tries to downgrade as few other modules as possible.</p> <p>If a requirement is incompatible with the proposed downgrade (if the requirement's build list includes a now-disallowed module version), then it successively tries older versions until it finds one that is compatible with the downgrade.</p> <p><strong>Commands:</strong></p> <ul> <li><code>go get foo@v1.2.3</code> =&gt; downgrade the <code>foo</code> package to the specified version</li> </ul> <h2 id=what-advantage-does-this-have-over-systems-that-use-lock-files>What advantage does this have over systems that use <em>lock</em> files?<a class=headerlink href=#what-advantage-does-this-have-over-systems-that-use-lock-files title="Permanent link">&para;</a></h2> <p>Because a module's dependency requirements are included with the module's source code to uniquely determine how to build it, and because the <a href=#how-does-the-minimal-version-selection-mvs-algorithm-construct-the-build-list-for-a-given-module><em>Minimal Version Selection</em> algorithm</a> provides high-fidelity builds by using the oldest version available that meets the dependency requirements, mechanisms such as <em>lock</em> files are not needed.</p> <p>In other systems, the <em>lock</em> file lists the specific versions a build should use. It only guarantees reproducible builds for whole programs, not for library modules.</p> <h2 id=why-does-using-go-modules-make-vendoring-unnecessary>Why does using Go Modules make vendoring unnecessary?<a class=headerlink href=#why-does-using-go-modules-make-vendoring-unnecessary title="Permanent link">&para;</a></h2> <p>Previously, if you were using an external package and worried that it might change in unexpected ways, you copied it to your local repository, and stored the copy under a new import path that identified it as a local copy, for example:</p> <ul> <li>github.com/pkg =&gt; my_local_path/external/github.com/pkg</li> </ul> <p>Over time, this was encapsulated in tools that copied a dependency into your repository and also updated all the import paths wihin it to reflect the new location. However, these modifications made it harder to compare against, and even incorporate newer copies, required updates, etc., to other code using that dependency. </p> <p>Package managers like <code>go dep</code> evolved to become a tool that could be used for freezing external package dependencies. This introduced the concept of <em>vendoring</em>, where you could copy dependencies into the project without modifying the source files as long as the <code>GOPATH</code> was correctly set up. But these vendoring tools relied on metadata files such as <code>glide.yml</code> or <code>dep.yml</code> to provide reproducible builds, and could not help with deciding which versions of a package to use. </p> <p><em>Vendor</em> directories:</p> <ul> <li>specify by their contents, the exact version of the dependencies to use when running <code>go build</code>.</li> <li>ensure the availability of those dependencies, even if the original copies disappear.</li> <li>are unwieldly and bloat the repositories in which they are used.</li> </ul> <p><code>GOPATH</code> was used to:</p> <ul> <li>define the versions of dependencies.</li> <li>hold the source code for those dependencies.</li> <li>provide a way to infer the import path for code in a specific directory.</li> </ul> <p>With Go Modules, <code>GOPATH</code>s are no longer required because the <code>go.mod</code> file includes the full module path and defines the version of each dependency in use. Further, since a directory with a <code>go.mod</code> file marks the root of the directory tree, this directory serves as a self-contained workspace, and is separate from all other directories. </p> <h2 id=why-are-pseudo-versions-used-to-identify-untagged-commits>Why are pseudo-versions used to identify untagged commits?<a class=headerlink href=#why-are-pseudo-versions-used-to-identify-untagged-commits title="Permanent link">&para;</a></h2> <p>To name untagged commits, Go Modules use the pseudo-version format <code>v0.0.0-yyyymmddhhmmss-{commit identifier}</code> to identify a specific commit made on a given date. The <em>commit identifier</em> is typically a shorted Git hash, and must have a commit time matching the UTC timestamp. </p> <p>The pseudo-version form is used so that <a href=https://semver.org/#spec-item-11><em>Semantic Versioning Precedence Rules</em></a> can be used to compare two pseudo-versions by commit time, since the timestamp encoding makes string comparison match time comparison. This also ensures that <code>go mod</code> always prefers a tagged semantic version(even if it's very old, such as <code>v0.0.1</code>), over an untagged pseudo-version, since it has a greater semantic version precedence than any <code>v0.0.0</code> pre-release</p> <h2 id=can-i-use-go-modules-along-with-the-traditional-gopath-based-mechanisms>Can I use Go Modules along with the traditional <code>GOPATH</code>-based mechanisms?<a class=headerlink href=#can-i-use-go-modules-along-with-the-traditional-gopath-based-mechanisms title="Permanent link">&para;</a></h2> <p>Currently, the Go command defaults to module mode when run in directories outside <code>GOPATH/src</code> that are marked by <code>go.mod</code> files in their roots. This can be overriden by setting the <strong><em>transitional</em></strong> environment variable <code>$GO111MODULE</code> to <code>on</code> or <code>off</code>. The default mode is <code>auto</code>.</p> <h2 id=how-can-i-make-the-current-directory-the-root-of-a-module>How can I make the current directory, the root of a module?<a class=headerlink href=#how-can-i-make-the-current-directory-the-root-of-a-module title="Permanent link">&para;</a></h2> <p><code>go mod init</code> : when working in a directory outside <code>$GOPATH</code>. This command writes a <code>go.mod</code> file at the root of your directory</p> <h2 id=can-packages-also-have-gomod-files>Can packages also have <code>go.mod</code> files?<a class=headerlink href=#can-packages-also-have-gomod-files title="Permanent link">&para;</a></h2> <p>The <code>go.mod</code> file only appears in the root of the module. Packages in subdirectories have import paths consisting of the module path and the path to that subdirectory.</p> <h2 id=what-happens-if-a-package-is-not-provided-by-any-module-in-gomod>What happens if a package is not provided by any module in <code>go.mod</code>?<a class=headerlink href=#what-happens-if-a-package-is-not-provided-by-any-module-in-gomod title="Permanent link">&para;</a></h2> <p>The Go command automatically looks up the module containing that package and adds it to <code>go.mod</code> using the <em>latest</em> version. <em>Latest</em> is defined as the latest tagged stable version, or else, the latest tagged pre-release version, or else, the latest untagged version. Only direct dependencies are recorded in the <code>go.mod</code> file.</p> <h2 id=can-modules-be-cached-locally>Can modules be cached locally?<a class=headerlink href=#can-modules-be-cached-locally title="Permanent link">&para;</a></h2> <p>Yes, they are cached locally in <code>$GOPATH/pkg/mod</code></p> <h2 id=how-are-different-major-versions-of-package-distinguished>How are different major versions of package distinguished?<a class=headerlink href=#how-are-different-major-versions-of-package-distinguished title="Permanent link">&para;</a></h2> <p>Every major version of a <code>Go Module</code> <em><code>{v1, v2, v3, ...}</code></em> uses a different module path. Starting at <code>v2</code>, the module path must end in the major version. <a href=#why-semantic-import-versioning><em>Semantic Import Versioning</em></a> is used to give incompatible packages(packages with different major versions) different names. </p> <h2 id=can-i-build-a-program-using-different-minor-versions>Can I build a program using different minor versions?<a class=headerlink href=#can-i-build-a-program-using-different-minor-versions title="Permanent link">&para;</a></h2> <p>No, since these are considered duplicates of a single module path. Go Modules allow a build to include at most one version of any particular module path, which means, at most, one of each major version. Allowing different major versions of a module (since they have different paths) enables incremental upgrades to a new major version. </p> <h2 id=how-do-i-clean-up-unused-dependencies>How do I clean up unused dependencies?<a class=headerlink href=#how-do-i-clean-up-unused-dependencies title="Permanent link">&para;</a></h2> <p><code>go mod tidy</code></p> <h2 id=what-does-go-mod-tidy-do>What does <code>go mod tidy</code> do?<a class=headerlink href=#what-does-go-mod-tidy-do title="Permanent link">&para;</a></h2> <p><code>go mod tidy</code> finds all the packages transitively imported by packages in your module and adds new module requirements for packages not provided by any known modules, while removing requirements on modules that do not provide any imported packages. If a module provides packages that are only imported by projects that have not yet migrated to modules, it marks that module requirement with an <code>// indirect</code> comment.</p> <h2 id=i-get-errors-when-i-run-go-mod-tidy-what-could-it-be>I get errors when I run <code>go mod tidy</code>, what could it be?<a class=headerlink href=#i-get-errors-when-i-run-go-mod-tidy-what-could-it-be title="Permanent link">&para;</a></h2> <ul> <li>When <code>go mod tidy</code> adds a requirement, it adds the latest version of the module. However, if your <code>$GOPATH</code> included an older version of a dependency that subsequently published a breaking change,<code>go mod tidy</code> will be unable to resolve the right package. </li> <li>Run <code>go mod graph</code> to get a graph of the module dependency requirements and then try downgrading to an older version with the <code>go get</code> command.</li> </ul> <h2 id=how-can-i-fix-tests-that-are-failing-because-they-cannot-write-files-in-the-package-directory>How can I fix tests that are failing because they cannot write files in the package directory?<a class=headerlink href=#how-can-i-fix-tests-that-are-failing-because-they-cannot-write-files-in-the-package-directory title="Permanent link">&para;</a></h2> <p>Tests may fail when the package directory is in the module cache, which has read-only access. Configure your tests to copy the files they need to write to a temporary directory instead. </p> <h2 id=how-can-i-fix-tests-that-are-failing-because-they-rely-on-relative-paths-to-packages-in-another-module>How can I fix tests that are failing because they rely on relative paths to packages in another module<a class=headerlink href=#how-can-i-fix-tests-that-are-failing-because-they-rely-on-relative-paths-to-packages-in-another-module title="Permanent link">&para;</a></h2> <p>Tests that use relative paths to locate and read files in another package can fail if the package resides in a different module. You can either:</p> <ul> <li>copy the test inputs into your module</li> <li>convert the test inputs from raw files to data embedded in <code>.go</code> source files</li> </ul> <h2 id=how-can-i-fix-tests-that-are-failing-becase-they-expect-go-commands-within-the-test-to-run-in-gopath-mode>How can I fix tests that are failing becase they expect <code>go</code> commands within the test to run in <code>$GOPATH</code> mode?<a class=headerlink href=#how-can-i-fix-tests-that-are-failing-becase-they-expect-go-commands-within-the-test-to-run-in-gopath-mode title="Permanent link">&para;</a></h2> <ul> <li>Add a <code>go.mod</code> file to the source tree to be tested</li> <li>Set <code>GO111MODULE=off</code></li> </ul> <h2 id=how-do-i-release-a-new-module-after-committing-my-changes>How do I release a new module after committing my changes?<a class=headerlink href=#how-do-i-release-a-new-module-after-committing-my-changes title="Permanent link">&para;</a></h2> <ul> <li>tag your release <code>git tag v1.2.3</code></li> <li>publish your release with the same tag <code>git push origin v1.2.3</code></li> </ul> <p>The new <code>go.mod</code> file at the root of your module defines the canonical import path for the module and adds the new minimum version requirements</p> <h2 id=how-do-i-know-which-environment-variable-to-use-when-working-with-go-modules>How do I know which environment variable to use when working with Go Modules?<a class=headerlink href=#how-do-i-know-which-environment-variable-to-use-when-working-with-go-modules title="Permanent link">&para;</a></h2> <ul> <li><code>GO111MODULE={on|off}</code> =&gt; transitional variable to toggle the use of Go Modules</li> <li><code>GOPRIVATE</code> =&gt; controls which modules the Go command considers to be private (not available publicly) and should therefore not use the proxy or checksum database. ex: <code>export GOPRIVATE=github.com/foo</code></li> <li><code>GONOPROXY</code> =&gt; overrides <code>GOPRIVATE</code> for the specific decision of whether to use a proxy. ex: <code>export GONOPROXY=github.com/foo</code></li> <li><code>GONOSUMDB</code> =&gt; overrides <code>GOPRIVATE</code> for the specific decision of whether to use the checksum database. ex: <code>export GONOSUMDB=github.com/foo</code></li> </ul> <h2 id=help-my-build-is-failing-and-i-dont-know-where-to-start>Help! My build is failing and I don't know where to start!<a class=headerlink href=#help-my-build-is-failing-and-i-dont-know-where-to-start title="Permanent link">&para;</a></h2> <ul> <li>Ensure that the following environment variables are appropriately set: <code>GOPRIVATE</code>, <code>GONOPROXY</code>, <code>GONOSUMDB</code></li> <li>Run <a href=#what-does-go-mod-tidy-do><code>go mod tidy</code></a></li> <li>Run <code>go mod graph</code> to <a href=#how-are-the-module-versions-to-use-in-each-build-determined>make sense of the module dependency requirements</a></li> <li>Apply your understanding of how dependency requirements are resolved based on the following scenarios:<ul> <li><a href=#how-does-the-mvs-algorithm-upgrade-all-modules-to-their-latest-version>upgrading all modules</a></li> <li><a href=#how-does-the-mvs-algorithm-upgrade-one-module-to-a-specific-newer-version>upgrading one module</a></li> <li><a href=#how-does-the-mvs-algorithm-downgrade-one-module-to-a-specific-older-version>downgrading one module</a></li> <li>If all else fails, someone in the <code>#dev-go-talk</code> may be able to help</li> </ul> </li> </ul> <h2 id=reference>Reference<a class=headerlink href=#reference title="Permanent link">&para;</a></h2> <ul> <li><a href=https://research.swtch.com/vgo>original series of articles on Go Modules, written by Russ Cox</a>, the creator of Go Modules</li> <li><a href=https://blog.golang.org/using-go-modules>Go blog articles on Go Modules</a></li> </ul> <details class=tip open=open><summary>Need help?</summary><ul> <li>Post your question on these Slack channels:</li> <li>Dev Go Talk @ <code>#dev-go-talk</code></li> </ul> <p><strong>Did you find this page useful?</strong></p> <p><img alt=😍 class=twemoji src=https://twemoji.maxcdn.com/v/latest/svg/1f60d.svg title=:heart_eyes:> <a href=https://forms.gle/bMu4PvHKzS2JqcVN9><strong>Yes!</strong></a></p> <p><img alt=😢 class=twemoji src=https://twemoji.maxcdn.com/v/latest/svg/1f622.svg title=:cry:> <a href=https://forms.gle/UvsrHfZBevR2rSP36><strong>No</strong></a></p> </details> <p><strong>Maintained by:</strong> Kelvin Spencer</p> <hr> <div class=md-source-date> <small> Last update: June 3, 2020 </small> </div> </article> </div> </div> </main> <footer class=md-footer> <div class=md-footer-nav> <nav class="md-footer-nav__inner md-grid" aria-label=Footer> <a href=.. title=Home class="md-footer-nav__link md-footer-nav__link--prev" rel=prev> <div class="md-footer-nav__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </div> <div class=md-footer-nav__title> <div class=md-ellipsis> <span class=md-footer-nav__direction> Previous </span> Home </div> </div> </a> <a href=../getting-started-with-cuelang/ title=Cuelang class="md-footer-nav__link md-footer-nav__link--next" rel=next> <div class=md-footer-nav__title> <div class=md-ellipsis> <span class=md-footer-nav__direction> Next </span> Cuelang </div> </div> <div class="md-footer-nav__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg> </div> </a> </nav> </div> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-footer-copyright> <div class=md-footer-copyright__highlight> Copyright &copy; 2019 - 2020 Kelvin Spencer </div> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> </div> </div> </footer> </div> <script src=../assets/javascripts/vendor.d710d30a.min.js></script> <script src=../assets/javascripts/bundle.5f27aba8.min.js></script><script id=__lang type=application/json>{"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents"}</script> <script>
        app = initialize({
          base: "..",
          features: ["instant", "tabs"],
          search: Object.assign({
            worker: "../assets/javascripts/worker/search.27c6a5e6.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script> </body> </html>